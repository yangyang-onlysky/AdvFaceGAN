# conda环境 windows与Linux都可以
conda remove -n AdvFaceGAN --all -y
conda create -n AdvFaceGAN -y
conda activate AdvFaceGAN
conda install pytorch torchvision torchaudio pytorch-cuda=12.1 -c pytorch -c nvidia -y
conda install torchmetrics tqdm tensorboard multiprocess  -y
conda install -c conda-forge jupyter -y
conda install matplotlib -y
conda install ipykernel -y
python -m ipykernel install --user --name=AdvFaceGAN --display-name "AdvFaceGAN"

pip install alibabacloud_facebody20191230
pip install -i https://mirrors.tencent.com/pypi/simple/ --upgrade tencentcloud-sdk-python

# 预处理单开环境
conda deactivate
conda remove -n frb --all -y
conda create -n frb -y
conda activate frb
conda install tensorflow-gpu==2.6.0 -y
conda install -c fastai opencv-python-headless -y
conda install imageio -y
conda install numpy==1.23.4 -y
conda install scikit-image -y
conda install tqdm -y
conda install ipykernel -y
python -m ipykernel install --user --name=frb --display-name "frb"



# bug fix！！！！！
报错libiomp5md.dll就在conda环境AdvFaceGAN目录下搜索libiomp5md.dll然后把第一个删了


# 趋动云镜像
RUN wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh &&\
    chmod +x Miniconda3-latest-Linux-x86_64.sh &&\
    ./Miniconda3-latest-Linux-x86_64.sh -b -p /root/miniconda3 &&\
    rm ./Miniconda3-latest-Linux-x86_64.sh
ENV PATH="/root/miniconda3/bin:$PATH"
RUN conda create -n AdvFaceGAN -y
SHELL ["conda", "run", "-n", "AdvFaceGAN", "/bin/bash", "-c"]
RUN conda install tqdm tensorboard torchmetrics pytorch torchvision torchaudio pytorch-cuda=12.1 -c pytorch -c nvidia -y


# 训练任务指令
eval "$(/root/miniconda3/bin/conda shell.bash hook)"
conda activate AdvFaceGAN
cd /gemini/code/AdvFaceGAN/
python train.py --config='config/target.ini' --output='./save_dir/target 3 8白盒 正确ssim 无stloss' --pert 3 --stlossfactor 0

nohup 'python train.py --config='config/target.ini' --output='./save_dir/target 4 8白盒 无stloss' --pert 4 --stlossfactor 0' > target_4_8白盒_无stloss.log 2>&1 &
